import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import { describe, it, expect, vi } from 'vitest';

import { Results } from './Results'; 

const mockSetSortedData = vi.fn();
const mockData = [{"id":"1","itineraries":[{"duration":"PT3H10M","segments":[{"departure":{"iataCode":"LAX","at":"2024-09-28T14:35:00","terminal":"1"},"arrival":{"iataCode":"GDL","at":"2024-09-28T18:45:00","terminal":"1"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"511","duration":"PT3H10M","id":"1","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]},{"duration":"PT2H25M","segments":[{"departure":{"iataCode":"GDL","at":"2024-10-12T05:45:00","terminal":"1"},"arrival":{"iataCode":"LAX","at":"2024-10-12T07:10:00","terminal":"B"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"512","duration":"PT2H25M","id":"6","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]}],"price":{"currency":"EUR","total":"324.50","base":"169.00","fees":[{"amount":"0.00","type":"SUPPLIER"},{"amount":"0.00","type":"TICKETING"}],"grandTotal":"34.50"},"travelerPricings":[{"travelerId":"1","fareOption":"STANDARD","travelerType":"ADULT","price":{"currency":"EUR","total":"324.50","base":"169.00","fees":null,"grandTotal":null},"fareDetailsBySegment":[{"segmentId":"1","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"H"},{"segmentId":"6","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"Z"}]}],"grandTotal":"34.50","totalTravelTime":190},{"id":"2","itineraries":[{"duration":"PT3H10M","segments":[{"departure":{"iataCode":"LAX","at":"2024-09-28T23:45:00","terminal":"1"},"arrival":{"iataCode":"GDL","at":"2024-09-29T03:55:00","terminal":"1"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"519","duration":"PT3H10M","id":"2","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]},{"duration":"PT2H25M","segments":[{"departure":{"iataCode":"GDL","at":"2024-10-12T05:45:00","terminal":"1"},"arrival":{"iataCode":"LAX","at":"2024-10-12T07:10:00","terminal":"B"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"512","duration":"PT2H25M","id":"6","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]}],"price":{"currency":"EUR","total":"324.50","base":"169.00","fees":[{"amount":"0.00","type":"SUPPLIER"},{"amount":"0.00","type":"TICKETING"}],"grandTotal":"999.50"},"travelerPricings":[{"travelerId":"1","fareOption":"STANDARD","travelerType":"ADULT","price":{"currency":"EUR","total":"324.50","base":"169.00","fees":null,"grandTotal":null},"fareDetailsBySegment":[{"segmentId":"2","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"H"},{"segmentId":"6","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"Z"}]}],"grandTotal":"999.50","totalTravelTime":190},{"id":"4","itineraries":[{"duration":"PT3H10M","segments":[{"departure":{"iataCode":"LAX","at":"2024-09-28T14:35:00","terminal":"1"},"arrival":{"iataCode":"GDL","at":"2024-09-28T18:45:00","terminal":"1"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"511","duration":"PT3H10M","id":"1","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]},{"duration":"PT3H25M","segments":[{"departure":{"iataCode":"GDL","at":"2024-10-12T19:50:00","terminal":"1"},"arrival":{"iataCode":"LAX","at":"2024-10-12T22:15:00","terminal":"B"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"518","duration":"PT3H25M","id":"7","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]}],"price":{"currency":"EUR","total":"324.50","base":"169.00","fees":[{"amount":"0.00","type":"SUPPLIER"},{"amount":"0.00","type":"TICKETING"}],"grandTotal":"324.60"},"travelerPricings":[{"travelerId":"1","fareOption":"STANDARD","travelerType":"ADULT","price":{"currency":"EUR","total":"324.50","base":"169.00","fees":null,"grandTotal":null},"fareDetailsBySegment":[{"segmentId":"1","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"H"},{"segmentId":"7","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"Z"}]}],"grandTotal":"324.60","totalTravelTime":190},{"id":"5","itineraries":[{"duration":"PT3H10M","segments":[{"departure":{"iataCode":"LAX","at":"2024-09-28T23:45:00","terminal":"1"},"arrival":{"iataCode":"GDL","at":"2024-09-29T03:55:00","terminal":"1"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"519","duration":"PT3H10M","id":"2","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]},{"duration":"PT3H25M","segments":[{"departure":{"iataCode":"GDL","at":"2024-10-12T19:50:00","terminal":"1"},"arrival":{"iataCode":"LAX","at":"2024-10-12T22:15:00","terminal":"B"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"518","duration":"PT3H25M","id":"7","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]}],"price":{"currency":"EUR","total":"324.50","base":"169.00","fees":[{"amount":"0.00","type":"SUPPLIER"},{"amount":"0.00","type":"TICKETING"}],"grandTotal":"324.40"},"travelerPricings":[{"travelerId":"1","fareOption":"STANDARD","travelerType":"ADULT","price":{"currency":"EUR","total":"324.50","base":"169.00","fees":null,"grandTotal":null},"fareDetailsBySegment":[{"segmentId":"2","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"H"},{"segmentId":"7","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"Z"}]}],"grandTotal":"324.40","totalTravelTime":190},{"id":"7","itineraries":[{"duration":"PT3H10M","segments":[{"departure":{"iataCode":"LAX","at":"2024-09-28T14:35:00","terminal":"1"},"arrival":{"iataCode":"GDL","at":"2024-09-28T18:45:00","terminal":"1"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"511","duration":"PT3H10M","id":"1","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]},{"duration":"PT3H30M","segments":[{"departure":{"iataCode":"GDL","at":"2024-10-12T10:50:00","terminal":"1"},"arrival":{"iataCode":"LAX","at":"2024-10-12T13:20:00","terminal":"B"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"510","duration":"PT3H30M","id":"8","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]}],"price":{"currency":"EUR","total":"345.50","base":"190.00","fees":[{"amount":"0.00","type":"SUPPLIER"},{"amount":"0.00","type":"TICKETING"}],"grandTotal":"345.50"},"travelerPricings":[{"travelerId":"1","fareOption":"STANDARD","travelerType":"ADULT","price":{"currency":"EUR","total":"345.50","base":"190.00","fees":null,"grandTotal":null},"fareDetailsBySegment":[{"segmentId":"1","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"H"},{"segmentId":"8","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"B"}]}],"grandTotal":"345.50","totalTravelTime":190},{"id":"8","itineraries":[{"duration":"PT3H10M","segments":[{"departure":{"iataCode":"LAX","at":"2024-09-28T23:45:00","terminal":"1"},"arrival":{"iataCode":"GDL","at":"2024-09-29T03:55:00","terminal":"1"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"519","duration":"PT3H10M","id":"2","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]},{"duration":"PT3H30M","segments":[{"departure":{"iataCode":"GDL","at":"2024-10-12T10:50:00","terminal":"1"},"arrival":{"iataCode":"LAX","at":"2024-10-12T13:20:00","terminal":"B"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"510","duration":"PT3H30M","id":"8","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]}],"price":{"currency":"EUR","total":"345.50","base":"190.00","fees":[{"amount":"0.00","type":"SUPPLIER"},{"amount":"0.00","type":"TICKETING"}],"grandTotal":"345.50"},"travelerPricings":[{"travelerId":"1","fareOption":"STANDARD","travelerType":"ADULT","price":{"currency":"EUR","total":"345.50","base":"190.00","fees":null,"grandTotal":null},"fareDetailsBySegment":[{"segmentId":"2","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"H"},{"segmentId":"8","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"B"}]}],"grandTotal":"345.50","totalTravelTime":190},{"id":"10","itineraries":[{"duration":"PT3H17M","segments":[{"departure":{"iataCode":"LAX","at":"2024-09-28T10:46:00","terminal":"6"},"arrival":{"iataCode":"GDL","at":"2024-09-28T15:03:00","terminal":"1"},"carrierCode":"AS","carrierDescription":"Testing without dictionary","number":"1418","duration":"PT3H17M","id":"4","aircraft":{"code":"73J","description":"Testing without dictionary2"},"operating":{"carrierCode":"AS","carrierDescription":"Testing without dictionary3"}}]},{"duration":"PT3H20M","segments":[{"departure":{"iataCode":"GDL","at":"2024-10-12T15:55:00","terminal":"1"},"arrival":{"iataCode":"LAX","at":"2024-10-12T18:15:00","terminal":"7"},"carrierCode":"AS","carrierDescription":"Testing without dictionary","number":"1419","duration":"PT3H20M","id":"5","aircraft":{"code":"73J","description":"Testing without dictionary2"},"operating":{"carrierCode":"AS","carrierDescription":"Testing without dictionary3"}}]}],"price":{"currency":"EUR","total":"436.55","base":"277.00","fees":[{"amount":"0.00","type":"SUPPLIER"},{"amount":"0.00","type":"TICKETING"}],"grandTotal":"436.55"},"travelerPricings":[{"travelerId":"1","fareOption":"STANDARD","travelerType":"ADULT","price":{"currency":"EUR","total":"436.55","base":"277.00","fees":null,"grandTotal":null},"fareDetailsBySegment":[{"segmentId":"4","cabin":"ECONOMY","brandedFare":"SV","amenities":[{"description":"STANDARD PIECE MAX 50LB 62LI","chargeable":false},{"description":"MEAL 1","chargeable":false},{"description":"110V AC POWER","chargeable":false},{"description":"USB POWER","chargeable":false}],"class":"X"},{"segmentId":"5","cabin":"ECONOMY","brandedFare":"SV","amenities":[{"description":"STANDARD PIECE MAX 50LB 62LI","chargeable":false},{"description":"MEAL 1","chargeable":false},{"description":"110V AC POWER","chargeable":false},{"description":"USB POWER","chargeable":false}],"class":"X"}]}],"grandTotal":"436.55","totalTravelTime":197},{"id":"3","itineraries":[{"duration":"PT4H10M","segments":[{"departure":{"iataCode":"LAX","at":"2024-09-28T08:25:00","terminal":"1"},"arrival":{"iataCode":"GDL","at":"2024-09-28T13:35:00","terminal":"1"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"513","duration":"PT4H10M","id":"3","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]},{"duration":"PT2H25M","segments":[{"departure":{"iataCode":"GDL","at":"2024-10-12T05:45:00","terminal":"1"},"arrival":{"iataCode":"LAX","at":"2024-10-12T07:10:00","terminal":"B"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"512","duration":"PT2H25M","id":"6","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]}],"price":{"currency":"EUR","total":"324.50","base":"169.00","fees":[{"amount":"0.00","type":"SUPPLIER"},{"amount":"0.00","type":"TICKETING"}],"grandTotal":"4.50"},"travelerPricings":[{"travelerId":"1","fareOption":"STANDARD","travelerType":"ADULT","price":{"currency":"EUR","total":"324.50","base":"169.00","fees":null,"grandTotal":null},"fareDetailsBySegment":[{"segmentId":"3","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"H"},{"segmentId":"6","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"Z"}]}],"grandTotal":"4.50","totalTravelTime":250},{"id":"6","itineraries":[{"duration":"PT4H10M","segments":[{"departure":{"iataCode":"LAX","at":"2024-09-28T08:25:00","terminal":"1"},"arrival":{"iataCode":"GDL","at":"2024-09-28T13:35:00","terminal":"1"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"513","duration":"PT4H10M","id":"3","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]},{"duration":"PT3H25M","segments":[{"departure":{"iataCode":"GDL","at":"2024-10-12T19:50:00","terminal":"1"},"arrival":{"iataCode":"LAX","at":"2024-10-12T22:15:00","terminal":"B"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"518","duration":"PT3H25M","id":"7","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]}],"price":{"currency":"EUR","total":"324.50","base":"169.00","fees":[{"amount":"0.00","type":"SUPPLIER"},{"amount":"0.00","type":"TICKETING"}],"grandTotal":"324.50"},"travelerPricings":[{"travelerId":"1","fareOption":"STANDARD","travelerType":"ADULT","price":{"currency":"EUR","total":"324.50","base":"169.00","fees":null,"grandTotal":null},"fareDetailsBySegment":[{"segmentId":"3","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"H"},{"segmentId":"7","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"Z"}]}],"grandTotal":"324.50","totalTravelTime":250},{"id":"9","itineraries":[{"duration":"PT4H10M","segments":[{"departure":{"iataCode":"LAX","at":"2024-09-28T08:25:00","terminal":"1"},"arrival":{"iataCode":"GDL","at":"2024-09-28T13:35:00","terminal":"1"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"513","duration":"PT4H10M","id":"3","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]},{"duration":"PT3H30M","segments":[{"departure":{"iataCode":"GDL","at":"2024-10-12T10:50:00","terminal":"1"},"arrival":{"iataCode":"LAX","at":"2024-10-12T13:20:00","terminal":"B"},"carrierCode":"VB","carrierDescription":"Testing without dictionary","number":"510","duration":"PT3H30M","id":"8","aircraft":{"code":"320","description":"Testing without dictionary2"},"operating":{"carrierCode":"VB","carrierDescription":"Testing without dictionary3"}}]}],"price":{"currency":"EUR","total":"345.50","base":"190.00","fees":[{"amount":"0.00","type":"SUPPLIER"},{"amount":"0.00","type":"TICKETING"}],"grandTotal":"345.50"},"travelerPricings":[{"travelerId":"1","fareOption":"STANDARD","travelerType":"ADULT","price":{"currency":"EUR","total":"345.50","base":"190.00","fees":null,"grandTotal":null},"fareDetailsBySegment":[{"segmentId":"3","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"H"},{"segmentId":"8","cabin":"ECONOMY","brandedFare":"ZERO","amenities":[{"description":"LAPTOP OR HANDBAG UP TO 85LCM","chargeable":false}],"class":"B"}]}],"grandTotal":"345.50","totalTravelTime":250}]
//const mockData = JSON.parse(mockDataJson);
const mockUpdatePriceSorting = vi.fn();
const mockUpdateDurationSorting = vi.fn();

describe('SearchContainer', ()=>{
    it('renders', ()=>{
        render(
            <Results setSortedData={mockSetSortedData}
            data={mockData}
            updatePriceSorting={mockUpdatePriceSorting}
            updateDurationSorting={mockUpdateDurationSorting}
            />
        );
    });
    screen.debug();
    it('renders and clicking on return button calls setSortedData', ()=>{
        render(
            <Results setSortedData={mockSetSortedData}
            data={mockData}
            updatePriceSorting={mockUpdatePriceSorting}
            updateDurationSorting={mockUpdateDurationSorting}
            />
        );
       fireEvent.click(screen.getByText('Return to search'))
       expect(mockSetSortedData).toBeCalled();
    });
    screen.debug();
    it('renders and clicking on Sort by duration button calls updateDurationSorting', ()=>{
        render(
            <Results setSortedData={mockSetSortedData}
            data={mockData}
            updatePriceSorting={mockUpdatePriceSorting}
            updateDurationSorting={mockUpdateDurationSorting}
            />
        );
       fireEvent.click(screen.getByText('Sort by duration: Unsorted'));
       expect(mockUpdateDurationSorting).toBeCalled();
    });
    screen.debug();
    it('renders and clicking on Sort by price button calls updatePriceSorting', ()=>{
        render(
            <Results setSortedData={mockSetSortedData}
            data={mockData}
            updatePriceSorting={mockUpdatePriceSorting}
            updateDurationSorting={mockUpdateDurationSorting}
            />
        );
       fireEvent.click(screen.getByText('Sort by price: Unsorted'));
       expect(mockUpdatePriceSorting).toBeCalled();
    });
    screen.debug();
})